<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Missions</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  </head>
  
    <div class="container">
      <form class="form-signin" id="shop-form" role="form" method="post">
      <h1 class="text-center">Missions</a></h6>
      <table class="table table-bordered" id = "missions" cellpadding="10">
      <tr name="data" >
        <th>Mission ID</th>
        <th>Mission Type</th>
        <th>Reward</th>
      </table>
      </form>
    </div>


    <script src="static/jquery/jquery-1.10.2.js"></script>
    <script src="static/bootstrap/js/bootstrap.min.js"></script>
	
		<script>
			var missions = new Array();
			var out = "";
			request("/mission/getAll", {}, function(data, _1, _2)
			{
				if (data['missions'] == null)
				{
						return;
				}
				for (var i = 0; i < data['missions'].length; i++) {
					var mission = new Object();
					mission.ID =  data['missions'][i][0];
					mission.Type = data['missions'][i][1];
					mission.RewardID = data['missions'][i][2];
					
					missions.push(mission);
				}		
			}).done(function()
			{
				// Get the Reward data for each mission				
				for (var j = 0; j < missions.length; j++) {
					var rewardItems = new Array();
					var currMission = missions[j];
					
					request("/reward/get", {rewardid: currMission.RewardID}, function(rewarddata, _1, _2)
					{
						for (var k = 0; k < rewarddata['rewarditems'].length; k++) {
							var rewarditem = new Object();
							currMission.Exp = rewarddata['rewardexp'][0][0];
							rewarditem.Item = rewarddata['rewarditems'][k][0];
							rewarditem.Quantity = rewarddata['rewarditems'][k][1];
							
							rewardItems.push(rewarditem);
						}
					}).done(function()
					{
						out += "<tr> <td> Mission " + currMission.ID + "</td>";
						out += "<td>" + currMission.Type + "</td>";
						
						out += "<td>" + currMission.Exp + " ";
						for (var l = 0; l < rewardItems; l++) {
							out += rewardItems[l].Quantity + " " + rewardItems[l].Item;
						}
						out += "</td></tr>";
						
						$(out).appendTo("#missions");
					});
				}
			});
		</script>
  </body>
</html>
